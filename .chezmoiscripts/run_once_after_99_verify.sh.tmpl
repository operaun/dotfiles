#!/bin/bash
set -euo pipefail

{{ if eq .chezmoi.os "darwin" -}}
echo "ğŸ” ì„¤ì¹˜ ê²€ì¦ ì¤‘..."
echo ""

# =============================================================================
# Homebrew ì„¤ì¹˜ í™•ì¸
# =============================================================================
missing_tools=()

check_command() {
  if command -v "$1" &>/dev/null; then
    echo "âœ… $1"
  else
    echo "âŒ $1 - ì„¤ì¹˜ í•„ìš”"
    missing_tools+=("$1")
  fi
}

# CLI ë„êµ¬ ê²€ì¦
echo "ğŸ“¦ CLI ë„êµ¬:"
check_command "starship"
check_command "zoxide"
check_command "eza"
check_command "bat"
check_command "fd"
check_command "rg"
check_command "fzf"
check_command "lazygit"
check_command "tldr"
check_command "jq"
check_command "nvim"

{{ if .isPersonal -}}
# Personal ì „ìš© ë„êµ¬
echo ""
echo "ğŸ” Personal ì „ìš©:"
check_command "infisical"
check_command "gpg"
{{- end }}

# =============================================================================
# ì„¤ì • íŒŒì¼ ê²€ì¦
# =============================================================================
echo ""
echo "ğŸ“„ ì„¤ì • íŒŒì¼:"

check_file() {
  if [[ -f "$1" ]]; then
    echo "âœ… $1"
  else
    echo "âŒ $1 - ì—†ìŒ"
  fi
}

check_file "$HOME/.zshrc"
check_file "$HOME/.gitconfig"
check_file "$HOME/.Brewfile"

if [[ -d "$HOME/.config/nvim" ]]; then
  echo "âœ… ~/.config/nvim (LazyVim)"
else
  echo "âŒ ~/.config/nvim - LazyVim ë¯¸ì„¤ì¹˜"
fi

# =============================================================================
# ê²°ê³¼ ìš”ì•½
# =============================================================================
echo ""
if [[ ${#missing_tools[@]} -eq 0 ]]; then
  echo "ğŸ‰ ëª¨ë“  ê²€ì¦ í†µê³¼!"
else
  echo "âš ï¸  ëˆ„ë½ëœ ë„êµ¬: ${missing_tools[*]}"
  echo "   'brew bundle --file=~/.Brewfile' ì‹¤í–‰ ê¶Œì¥"
fi
{{- end }}
